<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>ibis Single Table Verbs</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
  </style>
  <link rel="stylesheet" href="../assets/css/nucleo-icons.css">
  <link rel="stylesheet" href="../assets/css/quarto-material-kit.css">
  <link rel="stylesheet" href="../assets/css/custom.css">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 50,
    "keyboard-shortcut": [
      "f",
      "/",
      "s"
    ],
    "show-item-context": false,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-text-placeholder": "",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit",
      "search-label": "Search"
    }
  }</script>
  <style>

        .quarto-title-block .quarto-title-banner {
          background-image: url(../assets/img/methane_bubbles.jpg);
  background-size: cover;
        }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>


<body class="nav-sidebar floating nav-fixed fullcontent">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-platforms" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-pc-display-horizontal" role="img">
</i> 
 <span class="menu-text">Platforms</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-platforms">    
        <li>
    <a class="dropdown-item" href="https://codespaces.new/espm-288/website?quickstart=1"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">Codespaces</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gitpod.io/#https://github.com/espm-288/website"><i class="bi bi-app" role="img">
</i> 
 <span class="dropdown-text">GitPod</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/orgs/boettiger-lab/packages?repo_name=espm-288"><i class="bi bi-box" role="img">
</i> 
 <span class="dropdown-text">Containers</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://radiantearth.github.io/stac-browser/#/external/raw.githubusercontent.com/schmidtDSE/biodiversity-catalog/main/stac/v1/catalog.json?.language=en"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Data Catalog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/espm-288"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="bg-gradient-dark">
<div class="page-header min-vh-85" style="background-image: url(../assets/img/methane_bubbles.jpg);">
<span class="mask bg-gradient-dark opacity-3"></span>
<div class="container">
<div class="row justify-content-center">
<div class="col-lg-8 text-center mx-auto my-auto">
<h1 class="text-white"><code>ibis</code> Single Table Verbs</h1>
<p class="lead mb-4 text-white opacity-8"></p>
</div>
</div>
</div>
</div></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="menu-text">Tutorials in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/R/1-intro-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/R/2-earthdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NASA EarthData</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="menu-text">Tutorials in Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/00-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/01-github-jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to GitHub &amp; JupyterHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/02-visualization-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualization Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/03-data-access.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessing Real World Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/04-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transforming Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/04b-gh-actions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GitHub Actions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/05-ibis-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ibis</code> Single Table Verbs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/06-ibis-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ibis</code> Table Joins</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/06-ibis-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ibis</code> mutates and aggregates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/07-ibis-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>ibis</code> + <code>seaborn.objects</code>: Data Exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/spatial-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Spatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/spatial-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapping 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/spatial-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Processing Satellite Imagery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/spatial-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zonal Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/python/spatial-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapping and publishing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Recipes</span></span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true"><i class="bi bi-pc-display-horizontal" role="img">
</i> 
 <span class="menu-text">Platforms</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/computing-environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing Environments</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://codespaces.new/espm-288/website?quickstart=1" class="sidebar-item-text sidebar-link"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">Codespaces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://gitpod.io/#https://github.com/espm-288/website" class="sidebar-item-text sidebar-link"><i class="bi bi-app" role="img">
</i> 
 <span class="menu-text">GitPod</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/orgs/espm-288/packages" class="sidebar-item-text sidebar-link"><i class="bi bi-box" role="img">
</i> 
 <span class="menu-text">Containers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://radiantearth.github.io/stac-browser/#/external/raw.githubusercontent.com/schmidtDSE/biodiversity-catalog/main/stac/v1/catalog.json?.language=en" class="sidebar-item-text sidebar-link"><i class="bi bi-book" role="img">
</i> 
 <span class="menu-text">Data Catalog</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="card card-body blur shadow-blur mx-3 mx-md-4 mt-n6 mb-4">

<section class="position-relative">
<div class="container">
<div class="row">
<div class="col-12 mx-auto">
<p>We will be focusing on how to use the <code>ibis</code> package, a successor to the popular <code>pandas</code> package, for manipulating tabular data. We begin by importing the <code>ibis</code> package. (We include two additional imports from the package which are commonly referred to using their short names, the table placeholder <code>_</code> instead of <code>ibis._</code>, and the selectors methods as <code>s</code> instead of the verbose <code>ibis.selectors</code>. We will see these in action later).</p>
<section id="learning-goals" class="level3">
<h3 class="anchored" data-anchor-id="learning-goals">Learning Goals</h3>
<ul>
<li>establish a connection with <code>duckdb.connect()</code></li>
<li>use <code>head()</code> and <code>excute()</code> to preview large data</li>
<li>use <code>select()</code>, <code>distinct()</code>, <code>filter()</code> to explore data.</li>
</ul>
</section>
<section id="getting-started" class="level3">
<h3 class="anchored" data-anchor-id="getting-started">Getting started</h3>
<p>To use <code>ibis</code>, we must also select a backend. We will always be using the quite new and very powerful <code>duckdb</code> backend for all of our tasks. We select a backend by creating a “connection”. The details here are not important for us, we can treat this first block as “boilerplate” starting code.</p>
<div id="5cd06032" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ibis <span class="im">import</span> _</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ibis.selectors <span class="im">as</span> s</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> ibis.duckdb.<span class="ex">connect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now ready to read in our data. We will begin by reading the metrics table from the direct access link, as indicated in the URL below. <code>con.read_csv()</code> is quite similar to the <code>pandas.read_csv()</code> we saw in module 1, though the optional arguments get some different names and are not quite as flexibile. One important option for our purposes will be the how to indicate missing values. In the past, we’ve seen negative values like <code>-99</code> be used to indicate missing values. That convention reflects limitations of early software, which had no natural concept of “missing”. More modern conventions indicating missing values as “NULL” or “NA”. We indicate the data has chosen the latter:</p>
<div id="dc151e13-fcd6-4520-88a4-ff82360e1a08" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>metrics_url <span class="op">=</span> <span class="st">"https://huggingface.co/datasets/cboettig/ram_fisheries/resolve/main/v4.65/tsmetrics.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>tsmetrics <span class="op">=</span> con.read_csv(metrics_url, nullstr<span class="op">=</span><span class="st">"NA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="previewing-data-head-and-execute" class="level3">
<h3 class="anchored" data-anchor-id="previewing-data-head-and-execute">Previewing data: <code>head()</code> and <code>execute()</code></h3>
<p>Let’s take a look at our new table:</p>
<div id="1fd573d8-7328-46ed-b338-6019a081fd6e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>tsmetrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">DatabaseTable: ibis_read_csv_lnkh36a47bbdhi4vbfj7tetgry
  tscategory   string
  tsshort      string
  tslong       string
  tsunitsshort string
  tsunitslong  string
  tsunique     string
</pre>
</div>
</div>
<p>This doesn’t look like a pretty pandas table! Where are the values? Actually, as we become more familiar with <code>ibis</code> we learn to appreciate the display choice here. <code>ibis</code> is designed for working with very big data. An important part of this is something called <em>lazy evaluation</em>. Even downloading a very large fle might take a long time, and trying to load a large dataset into python all at once can exceed available RAM and crash the kernel. Instead, <code>ibis</code> merely “peeks” at the data over the remote connection – without even downloading it! It tells us the names of each column and the data type (e.g.&nbsp;string, or numeric, etc) that the read_csv method has ‘guessed’ for the data. As we will see, this is often the most useful information anway.</p>
<p>If we we do want to see a few example rows, we can use the method <code>head()</code> on the table, <code>tsmetrics.head()</code>, to say we want only want to see the top of the data frame. Optionally we can specify how many rows we want to preview, e.g.&nbsp;<code>tsmetrics.head(10)</code> to see 10 (the default is 5). Let’s try it:</p>
<div id="af593a11-49d3-4f4d-983b-e9a4295fcc16" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tsmetrics.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">r0 := DatabaseTable: ibis_read_csv_lnkh36a47bbdhi4vbfj7tetgry
  tscategory   string
  tsshort      string
  tslong       string
  tsunitsshort string
  tsunitslong  string
  tsunique     string

Limit[r0, n=5]
</pre>
</div>
</div>
<p>That’s not the top of 5 rows! Once again, <code>ibis</code> is being lazy. We see the same definition of the table as before, only this time it has a name <code>r0</code>, and we see a “plan of execution”, that ibis will return the first 5 rows <code>Limit[r0, 5]</code>. We can force it to execute this plan with <code>execute()</code> :</p>
<div id="fdc89821-85c7-495c-95ec-219a44fd2f44" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tsmetrics.head().execute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tscategory</th>
<th data-quarto-table-cell-role="th">tsshort</th>
<th data-quarto-table-cell-role="th">tslong</th>
<th data-quarto-table-cell-role="th">tsunitsshort</th>
<th data-quarto-table-cell-role="th">tsunitslong</th>
<th data-quarto-table-cell-role="th">tsunique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>OTHER TIME SERIES DATA</td>
<td>AQ</td>
<td>Aquaculture</td>
<td>MT</td>
<td>metric tons</td>
<td>AQ-MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>OTHER TIME SERIES DATA</td>
<td>ASP</td>
<td>Annual surplus production</td>
<td>MT</td>
<td>Metric tons</td>
<td>ASP-MT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>TOTAL BIOMASS</td>
<td>BdivBmgtpref</td>
<td>General biomass time series preferentially rel...</td>
<td>dimensionless</td>
<td>dimensionless</td>
<td>BdivBmgtpref-dimensionless</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>TOTAL BIOMASS</td>
<td>BdivBmgttouse</td>
<td>General biomass time series relative to manage...</td>
<td>dimensionless</td>
<td>dimensionless</td>
<td>BdivBmgttouse-dimensionless</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>TOTAL BIOMASS</td>
<td>BdivBmsypref</td>
<td>General biomass time series preferentially rel...</td>
<td>dimensionless</td>
<td>dimensionless</td>
<td>BdivBmsypref-dimensionless</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>At last, we are starting to see what the data really looks like. Data tables can quickly become much to large to explore by simply trying to eyeball every row. For instance, we notice the first column, <code>tscategory</code>, shows a few different possible categories for the various metrics in the database. So, how many distinct categories are there?</p>
</section>
<section id="select-and-distinct" class="level3">
<h3 class="anchored" data-anchor-id="select-and-distinct"><code>select()</code> and <code>distinct()</code></h3>
<p>To answer this, we will introduce a few more methods of data table manipulation. <code>select()</code> selects one or more <em>columns</em> of a given table, while <code>distinct()</code> returns only distinct (unique) rows of the table. Note that both of these methods share a common pattern – they both apply to a table (not some piece of a table, like a row or column or cell), and they both return a new table as well that is some subset of the old table. table in, table out. This design is very intentional – by having methods designed specificially to operate on tables and return tables, we can easily stack or chain these together, (also true of <code>head()</code> and execute()`. So let’s try and see distinct categories:</p>
<div id="986edd3f-ca50-4778-a52d-ad312118e27f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(tsmetrics</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> .select(<span class="st">"tscategory"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> .distinct()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> .head(<span class="dv">10</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> .execute()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tscategory</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>OTHER TIME SERIES DATA</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SPAWNING STOCK BIOMASS or CPUE</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>PRODUCTION</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>TOTAL BIOMASS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RECRUITS (NOTE: RECRUITS ARE OFFSET IN TIME SE...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>TIME UNITS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CATCH or LANDINGS</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>FISHING MORTALITY</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that we have stacked these methods together with each step on it’s own line by wrapping the whole thing inside <code>()</code> parentheses. This can make a long “chain” of commands easier to read. While we have asked for no more that 10 values, we have gotten back only 8 – so we now know there are only 8 categories.</p>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter"><code>filter()</code></h3>
<p>What are the different unit types within, say, the “CATCH or LANDINGS” category? This requires a subset of <em>rows</em> (a <em>filter</em>), rather than a subset of columns (<code>select()</code>):</p>
<div id="f2066c6a-d407-4ac1-b81a-013dd69d8d86" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(tsmetrics</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a> .<span class="bu">filter</span>(_.tscategory <span class="op">==</span> <span class="st">"CATCH or LANDINGS"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> .distinct()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a> .head(<span class="dv">14</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a> .execute()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tscategory</th>
<th data-quarto-table-cell-role="th">tsshort</th>
<th data-quarto-table-cell-role="th">tslong</th>
<th data-quarto-table-cell-role="th">tsunitsshort</th>
<th data-quarto-table-cell-role="th">tsunitslong</th>
<th data-quarto-table-cell-role="th">tsunique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CATCH or LANDINGS</td>
<td>CdivMSY-conv</td>
<td>Catch divided by MSY calculated from converted...</td>
<td>ratio</td>
<td>ratio</td>
<td>CdivMSY-conv-ratio</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CATCH or LANDINGS</td>
<td>CdivMSY</td>
<td>Catch divided by MSY</td>
<td>ratio</td>
<td>ratio</td>
<td>CdivMSY-ratio</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CATCH or LANDINGS</td>
<td>TAC-A2</td>
<td>Total allowable catch In subarea</td>
<td>MT</td>
<td>Metric tons</td>
<td>TAC-A2-MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>CATCH or LANDINGS</td>
<td>TC-3</td>
<td>Total catch. Use only when there is more than ...</td>
<td>E03</td>
<td>Thousands</td>
<td>TC-3-E03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CATCH or LANDINGS</td>
<td>TL-1</td>
<td>Total landings. Use only when there is more th...</td>
<td>E03MT</td>
<td>Thousands of metric tons</td>
<td>TL-1-E03MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>CATCH or LANDINGS</td>
<td>TL-A1</td>
<td>Total landings in subarea</td>
<td>MT</td>
<td>Metric tons</td>
<td>TL-A1-MT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>CATCH or LANDINGS</td>
<td>TL-A3</td>
<td>Total landings in subarea</td>
<td>MT</td>
<td>Metric tons</td>
<td>TL-A3-MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>CATCH or LANDINGS</td>
<td>CdivMSY-est</td>
<td>Catch divided by MSY calculated from model-est...</td>
<td>ratio</td>
<td>ratio</td>
<td>CdivMSY-est-ratio</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>CATCH or LANDINGS</td>
<td>TAC</td>
<td>Total allowable catch</td>
<td>MT</td>
<td>Metric tons</td>
<td>TAC-MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>CATCH or LANDINGS</td>
<td>TC-2</td>
<td>Total catch (i.e. landings + discards. Add lan...</td>
<td>MT</td>
<td>Metric tons</td>
<td>TC-2-MT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>CATCH or LANDINGS</td>
<td>TC</td>
<td>Total catch (i.e. landings + discards. Add lan...</td>
<td>E06</td>
<td>Millions</td>
<td>TC-E06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>CATCH or LANDINGS</td>
<td>TL-2</td>
<td>Total landings. Use only when there is more th...</td>
<td>MT</td>
<td>Metric tons</td>
<td>TL-2-MT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>CATCH or LANDINGS</td>
<td>TL-A4</td>
<td>Total landings in subarea</td>
<td>MT</td>
<td>Metric tons</td>
<td>TL-A4-MT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>CATCH or LANDINGS</td>
<td>CdivMSY-dvmb</td>
<td>Catch divided by MSY calculated from reference...</td>
<td>ratio</td>
<td>ratio</td>
<td>CdivMSY-dvmb-ratio</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This syntax to subset rows (filter) is more complicated than columns (select) – to find rows containing “CATCH or LANDINGS” we have to indicate <em>which</em> column to look for.</p>
<section id="column-selection-and-." class="level4">
<h4 class="anchored" data-anchor-id="column-selection-and-.">column selection and <code>.</code></h4>
<p>For python to know that we are looking for the column called “tscategory”, we use the column selection <code>_.tscategory</code>. This is actually a shorthand for the pattern <code>tsmetrics.tscategory</code> – the <code>_</code> is a placeholder for “the current table” in our chain. Extracting a single column with <code>.</code> is itself something of a shorthand, it is equivalent to using the selector <code>[</code>, as <code>tsmetrics["category"]</code>. When a column name is also the name of a table method, we may need to fall back on the square bracket convention. So why use a dot at all? In addition to taking two less characters to write, the <code>.</code> method allows “tab completion” of the column name, which helps us avoid typos. Note that our <code>select()</code> method recognizes either syntax, you can do: <code>tsmetrics.select(_.tscategory)</code>. This looks slightly more cryptic, but benefits from autocomplete and matches the sytnax of other functions.</p>
</section>
<section id="not" class="level4">
<h4 class="anchored" data-anchor-id="not"><code>==</code> not <code>=</code></h4>
<p>Another common mistake is to use a single <code>=</code> sign rather than <code>==</code> in filter. Recall that <code>=</code> is used in variable assignment, <code>a = 1</code> sets the value of <code>a</code> as 1. Double-equals is a “boolean operator”, that tests if the statement is True or False:</p>
<div id="a6137819-0799-4f85-be44-cfc88caf6ed6" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">==</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>True</code></pre>
</div>
</div>
<p>Other boolean operators include <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code> (not equal) and so forth. The important thing is to know that we can do boolean comparisons, this syntax is easy to look up.</p>
</section>
</section>
<section id="next-steps" class="level3">
<h3 class="anchored" data-anchor-id="next-steps">Next steps</h3>
<p>Explore the datasets in this collection using <code>select()</code>, <code>distinct()</code> and <code>filter()</code>. We will return to this list of Catch units after we become more aquainted with the remaining tables.</p>
<p>This syntax is harder than <code>select()</code> – we can’t just filter for “CATCH or LANDINGS” without indicating which column we are looking in. To signal that <code>tscategory</code> is a column name and not just a piece of text, we use the subsetting notation, <code>_.tscategory</code>. This is merely a shorthand for the more verbose:</p>


</section>
</div>
</div>
</div>
</section>
</div>

</main> <!-- /main -->
<script src="../assets/js/material-kit.js"></script>
<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.dev/espm-288/website/blob/main/reading/05-ibis-1.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/espm-288/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/espm-288/website">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://carlboettiger.info">
      <i class="bi bi-globe-americas" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>